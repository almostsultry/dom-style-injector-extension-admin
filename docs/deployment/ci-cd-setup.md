# **CI/CD Setup Guide for D365 DOM Style Injector Extension**

This guide outlines the Continuous Integration (CI) and Continuous Deployment (CD) setup for the D365 DOM Style Injector Extension. Implementing CI/CD ensures automated testing, building, and streamlined deployment to the Chrome Web Store and Microsoft Edge Add-ons.

## **Table of Contents**

1. [Overview](#bookmark=id.lj0kje9t80d6)  
2. [Tools and Services](#bookmark=id.v7x09w3apuq1)  
3. [CI Workflow (ci.yml)](#bookmark=id.5f02xod73t7k)  
   * [Trigger Conditions](#bookmark=id.9hzb3efwtjyw)  
   * [Steps](#bookmark=id.bwxsd5mrbk99)  
4. [CD Workflows](#bookmark=id.svwxux2qkv9k)  
   * [Deploy to Chrome Web Store (cd-chrome-store.yml)](#bookmark=id.9yi6uusf7l6e)  
   * [Deploy to Edge Add-ons (cd-edge-store.yml)](#bookmark=id.iykrecpjmlg7)  
5. [GitHub Releases Workflow (release.yml)](#bookmark=id.5q5ufspwyl02)  
6. [Environment Variables and Secrets](#bookmark=id.wvxhybxu06m1)  
7. [Troubleshooting CI/CD Pipelines](#bookmark=id.heodyrxlm4mc)

## **1\. Overview**

The CI/CD pipeline for the D365 DOM Style Injector Extension automates the entire software delivery lifecycle, from code commit to store submission. This ensures high quality, faster releases, and reduced manual effort.

* **Continuous Integration (CI):** Every code change triggers automated builds and tests, providing immediate feedback on code quality and functionality.  
* **Continuous Deployment (CD):** Approved changes are automatically built, packaged, and submitted to the respective browser stores.

## **2\. Tools and Services**

* **GitHub Actions:** Used as the CI/CD orchestrator.  
* **Node.js:** Runtime for build scripts and tests.  
* **npm/yarn:** Package manager.  
* **fs-extra, archiver, chalk, terser, clean-css:** Build utilities.  
* **Testing Frameworks:** Jest, Playwright (or Cypress).  
* **GitHub Web Store API / Microsoft Edge Add-ons API:** For programmatic submissions.  
* **GitHub Secrets:** For securely storing API keys and credentials.

## **3\. CI Workflow (.github/workflows/ci.yml)**

This workflow runs on every push to main and on every pull request, ensuring that changes integrate smoothly.

### **Trigger Conditions**

* on: \[push, pull\_request\]  
* branches: \[main\] (for pushes)

### **Steps**

1. **Checkout Code:** Clones the repository.  
2. **Setup Node.js:** Installs the required Node.js version.  
3. **Install Dependencies:** Runs npm install to get project dependencies.  
4. **Run Linting:** Executes ESLint or similar linters to check code style and potential errors.  
   * npm run lint  
5. **Run Unit Tests:** Executes all unit tests.  
   * npm run test:unit  
6. **Run Integration Tests:** Executes all integration tests.  
   * npm run test:integration  
7. **Run E2E Tests:** Executes end-to-end tests in a headless browser. Requires browser installation (e.g., Playwright's browser-install action).  
   * npm run test:e2e  
8. **Build Both Versions (Admin & User):** Runs build/release.js to create production-ready packages for both extension versions.  
   * npm run build:prod  
9. **Security Scan:** Runs vulnerability scans (e.g., Snyk, Dependabot, or configured static analysis) as per security/vulnerability-scan-config.yml.  
   * npm run security-scan (placeholder for a script that triggers scans)  
10. **Archive Build Artifacts:** Uploads the .zip files (admin-version.zip, user-version.zip) as artifacts for later use by CD workflows.

## **4\. CD Workflows**

CD workflows are typically triggered manually or upon successful completion of the CI workflow on the main branch, often combined with a release tag.

### **Deploy to Chrome Web Store (.github/workflows/cd-chrome-store.yml)**

This workflow automates the submission of the Admin and User versions to the Chrome Web Store.

### **Trigger Conditions**

* on: workflow\_dispatch (manual trigger)  
* on: push  
  * tags: \['v\*.\*.\*'\] (triggered by creating a new GitHub release tag)

### **Steps**

1. **Checkout Code:** Clones the repository.  
2. **Download Build Artifacts:** Retrieves the .zip files generated by the CI workflow.  
3. **Setup Node.js.**  
4. **Install Deployment Dependencies:** Installs any specific npm packages needed for store interaction (e.g., web-ext-submit).  
5. **Load Store Configuration:** Reads config/store-configs/chrome-store.json.  
6. **Submit Admin Version:**  
   * Uses Chrome Web Store API (via a CLI tool or script) to upload admin-version.zip.  
   * Utilizes CHROME\_CLIENT\_ID, CHROME\_CLIENT\_SECRET, CHROME\_REFRESH\_TOKEN secrets.  
   * Reads extensionId from chrome-store.json.  
7. **Submit User Version:**  
   * Uploads user-version.zip to its dedicated listing.  
   * Requires a separate extensionId for the user version.  
8. **Publish (Optional):** Configured for auto-publishing or requires manual review after upload.

### **Deploy to Edge Add-ons (.github/workflows/cd-edge-store.yml)**

Similar to the Chrome workflow, but targets the Microsoft Edge Add-ons store.

### **Trigger Conditions**

* on: workflow\_dispatch  
* on: push  
  * tags: \['v\*.\*.\*'\]

### **Steps**

1. **Checkout Code.**  
2. **Download Build Artifacts.**  
3. **Setup Node.js.**  
4. **Install Deployment Dependencies.**  
5. **Load Store Configuration:** Reads config/store-configs/edge-store.json.  
6. **Submit Admin Version:**  
   * Uses Edge Add-ons API (via a CLI tool or script) to upload admin-version.zip.  
   * Utilizes EDGE\_CLIENT\_ID, EDGE\_CLIENT\_SECRET, EDGE\_TENANT\_ID secrets (for Azure AD app registration for submission).  
   * Reads productId from edge-store.json.  
7. **Submit User Version:**  
   * Uploads user-version.zip to its dedicated listing.  
   * Requires a separate productId for the user version.  
8. **Publish (Optional):** Configured for auto-publishing or requires manual review after upload.

## **5\. GitHub Releases Workflow (.github/workflows/release.yml)**

This workflow automates the creation of GitHub releases.

### **Trigger Conditions**

* on: push  
  * branches: \[main\]  
* tags: \['v\*.\*.\*'\] (triggered after version-bump.js creates a new tag)

### **Steps**

1. **Checkout Code.**  
2. **Setup Node.js.**  
3. **Install Dependencies.**  
4. **Run Version Bump (Optional, if not done manually):** If the workflow is triggered by a merge to main without a tag, it might increment a patch version. If triggered by a tag, it simply proceeds.  
   * node scripts/version-bump.js patch (example)  
5. **Create GitHub Release:** Uses a GitHub Action (e.g., softprops/action-gh-release) to create a new release.  
   * Attaches the .zip artifacts from the build step to the release.  
   * Generates release notes from commit messages (if Conventional Commits are followed).

## **6\. Environment Variables and Secrets**

Crucial for CI/CD, these should be stored as GitHub Secrets (or equivalent in other CI systems) and **NEVER** committed to the repository.

* **CHROME\_CLIENT\_ID**: OAuth Client ID for Chrome Web Store API.  
* **CHROME\_CLIENT\_SECRET**: OAuth Client Secret for Chrome Web Store API.  
* **CHROME\_REFRESH\_TOKEN**: OAuth Refresh Token for Chrome Web Store API.  
* **EDGE\_CLIENT\_ID**: Azure AD Client ID for Edge Add-ons API.  
* **EDGE\_CLIENT\_SECRET**: Azure AD Client Secret for Edge Add-ons API.  
* **EDGE\_TENANT\_ID**: Azure AD Tenant ID for Edge Add-ons API.  
* **GITHUB\_TOKEN**: Automatically provided by GitHub Actions for interacting with GitHub API.

## **7\. Troubleshooting CI/CD Pipelines**

* **Check Workflow Runs:** Always review the logs of failed CI/CD runs in the GitHub Actions tab.  
* **Secrets Configuration:** Ensure all necessary secrets are correctly configured in your repository settings.  
* **API Quotas:** Be mindful of API rate limits for store submissions.  
* **Tooling Versions:** Ensure consistent Node.js and tool versions across local development and CI/CD.  
* **Permissions:** Verify that the GitHub Actions runner has the necessary permissions to perform actions (e.g., write to contents).