<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOM Style Injector - Settings</title>
    <link rel="stylesheet" href="../styles/common.css">
    <link rel="stylesheet" href="../styles/options.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>DOM Style Injector Settings</h1>
            <p class="subtitle">Configure your extension settings and authentication</p>
        </header>

        <main>
            <!-- D365 Configuration -->
            <section class="config-section">
                <h2>Dynamics 365 Configuration</h2>
                <div class="form-group">
                    <label for="d365-url">D365 Organization URL</label>
                    <input type="url" id="d365-url" placeholder="https://yourorg.crm.dynamics.com" required>
                    <small>Enter your Dynamics 365 organization URL</small>
                </div>
            </section>

            <!-- Azure AD Configuration -->
            <section class="config-section">
                <h2>Azure AD Configuration</h2>
                <div class="form-group">
                    <label for="client-id">Application (Client) ID</label>
                    <input type="text" id="client-id" placeholder="00000000-0000-0000-0000-000000000000">
                    <small>From your Azure AD app registration</small>
                </div>
                
                <div class="form-group">
                    <label for="tenant-id">Directory (Tenant) ID</label>
                    <input type="text" id="tenant-id" placeholder="00000000-0000-0000-0000-000000000000">
                    <small>Your Azure AD tenant ID</small>
                </div>
                
                <div class="info-box">
                    <h3>Redirect URI for Azure AD</h3>
                    <p>Add this to your app registration:</p>
                    <code id="redirect-uri">Loading...</code>
                    <button id="copy-redirect-uri" class="btn btn-sm">Copy</button>
                </div>
            </section>

            <!-- Development Options -->
            <section class="config-section">
                <h2>Development Options</h2>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="use-mock-token">
                        Use mock token for development
                    </label>
                </div>
                
                <div class="form-group" id="mock-token-group" style="display: none;">
                    <label for="mock-token">Mock Token (JWT)</label>
                    <textarea id="mock-token" rows="4" placeholder="Paste a valid JWT token for testing"></textarea>
                    <small>Warning: Only use this for development/testing</small>
                </div>
            </section>

            <!-- Synchronization Settings -->
            <section class="config-section">
                <h2>Synchronization Settings</h2>
                
                <!-- Dataverse Configuration -->
                <div class="form-group">
                    <label for="dataverse-table">Dataverse Table Name</label>
                    <input type="text" id="dataverse-table" placeholder="cr123_domstylecustomizations">
                    <small>Custom table name for storing customizations in Dataverse</small>
                </div>
                
                <!-- SharePoint Configuration -->
                <div class="form-group">
                    <label for="sharepoint-url">SharePoint Site URL</label>
                    <input type="url" id="sharepoint-url" placeholder="https://yourorg.sharepoint.com/sites/yoursite">
                    <small>SharePoint site for storing customizations (optional)</small>
                </div>
                
                <div class="form-group">
                    <label for="sharepoint-list">SharePoint List Name</label>
                    <input type="text" id="sharepoint-list" placeholder="DOM Style Customizations">
                    <small>List name in SharePoint for customizations</small>
                </div>
                
                <!-- Conflict Resolution -->
                <div class="form-group">
                    <label for="conflict-resolution">Conflict Resolution Strategy</label>
                    <select id="conflict-resolution" class="form-select">
                        <option value="newest_wins">Newest Wins (Recommended)</option>
                        <option value="remote_wins">Remote Wins (Dataverse/SharePoint Priority)</option>
                        <option value="local_wins">Local Wins (Keep Local Changes)</option>
                        <option value="merge">Merge (Combine Both)</option>
                        <option value="manual">Manual (Ask Each Time)</option>
                    </select>
                    <small>How to handle conflicts when syncing customizations</small>
                </div>
                
                <!-- Sync Options -->
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="auto-sync">
                        Enable automatic synchronization
                    </label>
                    <small>Automatically sync customizations every hour</small>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="sync-on-startup">
                        Sync on browser startup
                    </label>
                    <small>Sync customizations when the browser starts</small>
                </div>
            </section>

            <!-- Cache Management -->
            <section class="config-section">
                <h2>Cache Management</h2>
                <div class="cache-info">
                    <p>User role cache: <span id="role-cache-status">Checking...</span></p>
                    <p>Last sync: <span id="last-sync">Never</span></p>
                    <p>Last conflict: <span id="last-conflict">None</span></p>
                </div>
                
                <div class="button-group">
                    <button id="clear-cache" class="btn btn-secondary">Clear Cache</button>
                    <button id="sync-dataverse" class="btn btn-secondary">Sync with Dataverse</button>
                    <button id="sync-sharepoint" class="btn btn-secondary">Sync with SharePoint</button>
                </div>
            </section>

            <!-- Import/Export -->
            <section class="config-section">
                <h2>Import/Export Customizations</h2>
                <div class="button-group">
                    <button id="export-customizations" class="btn">Export Customizations</button>
                    <label for="import-file" class="btn">
                        Import Customizations
                        <input type="file" id="import-file" accept=".json" style="display: none;">
                    </label>
                </div>
            </section>

            <!-- Save Button -->
            <div class="save-section">
                <button id="save-settings" class="btn btn-primary">Save Settings</button>
                <span id="save-status"></span>
            </div>
        </main>
    </div>

    <script src="options.js"></script>
</body>
</html>